/*!
 * jquery-sheetrock v0.3.0
 * Quickly connect to, query, and lazy-load data from Google Spreadsheets.
 * http://chriszarate.github.io/sheetrock/
 * License: MIT
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof module&&module.exports?require("jquery"):a.jQuery||a.$)}(this,function(a){"use strict";var b=function(a,b){return a.target=this,a=t(a),a&&(y(b)&&null!==b?h(a,b):g(a)),this},c={2014:{endpoint:"https://docs.google.com/spreadsheets/d/%key%/gviz/tq",keyFormat:new RegExp("spreadsheets/d/([^/#]+)","i")},2010:{endpoint:"https://spreadsheets.google.com/tq?key=%key%",keyFormat:new RegExp("key=([^&#]+)","i")}},d={loaded:{},failed:{},offset:{}},e={},f=0,g=function(b){a.fn.sheetrock.promise=a.fn.sheetrock.promise.pipe(function(){return i(b)}).pipe(function(){return j(b)})},h=function(a,b){l(a),o.call(a,b),m.call(a)},i=function(b){var c={sql:"select * limit 1",dataHandler:r,userCallback:a.noop,target:!1};return-1===b.sql.indexOf("%")||s(b)?a.Deferred().resolve():(z("Prefetching column labels."),j(a.extend({},b,c)))},j=function(b){l(b),b.callback="sheetrock_callback_"+f,f+=1;var c={data:k(b),context:b,url:b.server,dataType:"jsonp",cache:!0,jsonp:!1,jsonpCallback:b.callback};return z(c,b.debug),a.ajax(c).promise().done(o).fail(u).always(m)},k=function(a){var b={gid:a.gid,tqx:"responseHandler:"+a.callback};return a.sql&&(b.tq=F(a.sql,s(a))),b},l=function(b){b.loading.show(),a.fn.sheetrock.working=!0},m=function(){this.loading.hide(),a.fn.sheetrock.working=!1,this.userCallback(this)},n=function(b,c){x(b,c)&&a.each(b[c],function(a,b){x(b,"detailed_message")?z(b.detailed_message):x(b,"message")&&z(b.message)})},o=function(a){if(n(a,"warnings"),n(a,"errors"),z(a,this.debug),x(a,"status","table")&&x(a.table,"cols","rows")){var b=p.call(this,a);this.dataHandler.call(b,a)}else u.call(this,a)},p=function(b){var c=this;return c.parsed={},c.parsed.last=c.chunkSize?Math.min(b.table.rows.length,c.chunkSize):b.table.rows.length,d.loaded[c.requestID]=!c.chunkSize||c.parsed.last<c.chunkSize,c.parsed.header=a.map(b.table.cols,D).length?1:0,c.parsed.labels=c.labels&&c.labels.length===b.table.cols.length?c.labels:a.map(b.table.cols,E),c},q=function(b){var c=this,d=c.target;a.extend(c,{thead:c.rowGroups?a("<thead/>").appendTo(d):d,tbody:c.rowGroups?a("<tbody/>").appendTo(d):d}),c.offset||c.headersOff||(c.parsed.header||!c.headers)&&c.thead.append(c.rowHandler({num:0,cells:H(c.parsed.labels)})),a.each(b.table.rows,function(b,d){if(x(d,"c")&&b<c.parsed.last){var e=w(c.offset+b+1+c.parsed.header-c.headers),f={num:e,cells:{}};(e||!c.headersOff)&&(a.each(d.c,function(a,b){var d=c.formatting?I(b):!1,e=b&&x(b,"v")&&b.v?b.v:"";e instanceof Array&&(e=x(b,"f")?b.f:e.join("")),e=c.cellHandler(e),f.cells[c.parsed.labels[a]]=d?K(e,"span",d):e}),f.num?c.tbody.append(c.rowHandler(f)):c.thead.append(c.rowHandler(f)))}})},r=function(b){var c={};a.each(b.table.cols,function(a,b){c[b.id]=E(b)}),e[this.key+"_"+this.gid]=c},s=function(b){return a.isEmptyObject(b.columns)?e[b.key+"_"+b.gid]||!1:b.columns},t=function(b){return b=a.extend({},a.fn.sheetrock.options,b),b.type=A(b.url),b.key=B(b.url,b.type),b.gid=C(b.url),b.server=b.server.length?b.server:b.type.endpoint,b.server=b.server.replace("%key%",b.key),b.key&&b.gid&&(b.requestID=b.key+"_"+b.gid+"_"+b.sql),b.chunkSize=b.target.length?w(b.chunkSize):0,b.headers=w(b.headers),b.loading=G(b.loading),b.resetStatus&&b.requestID&&(d.loaded[b.requestID]=!1,d.failed[b.requestID]=!1,d.offset[b.requestID]=0,z("Resetting request status.")),b.offset=d.offset[b.requestID]||0,b.chunkSize&&b.target&&b.requestID&&(b.sql+=" limit "+(b.chunkSize+1),b.sql+=" offset "+b.offset,d.offset[b.requestID]=b.offset+b.chunkSize),b.target.length||b.dataHandler!==q?b.url?b.key?b.gid?d.failed[b.requestID]?u.call(b,null,"A previous request for this resource failed."):d.loaded[b.requestID]?z("No more rows to load!"):(z(b,b.debug),b):u.call(b,null,"Could not find a gid in the provided URL."):u.call(b,null,"Could not find a key in the provided URL."):u.call(b,null,"No spreadsheet URL provided."):u.call(b,null,"No element targeted or data handler provided.")},u=function(a,b){return b=b||"Request failed.",this&&this.requestID&&(d.failed[this.requestID]=!0),z(b),this.errorHandler.call(this,a,b),!1},v=function(a){return a.toString().replace(/^ +/,"").replace(/ +$/,"")},w=function(a){return Math.max(0,parseInt(a,10)||0)},x=function(a){for(var b=1;b<arguments.length;b+=1)if(!y(a[arguments[b]]))return!1;return!0},y=function(){for(var a=0;a<arguments.length;a+=1)if("undefined"==typeof arguments[a])return!1;return!0},z=function(a,b){return b=y(b,console)?b:!0,b&&console.log&&console.log(a),!1},A=function(b){var d;return a.each(c,function(a,c){return c.keyFormat.test(b)?(d=c,!1):void 0}),d||c[2014]},B=function(a,b){return b.keyFormat.test(a)?a.match(b.keyFormat)[1]:!1},C=function(a){var b=new RegExp("gid=([^/&#]+)","i");return b.test(a)?a.match(b)[1]:!1},D=function(a){return x(a,"label")?a.label.replace(/\s/g,""):null},E=function(a){return D(a)||a.id},F=function(b,c){return a.each(c,function(a,c){b=b.replace(new RegExp("%"+c+"%","g"),a)}),b},G=function(b){return b instanceof a?b:a(b)},H=function(b){var c={};return a.each(b,function(a,b){c[b]=b}),c},I=function(a){return a&&x(a,"p")&&x(a.p,"style")?a.p.style:!1},J=function(a){var b,c="",d=a.num?"td":"th";for(b in a.cells)x(a.cells,b)&&(c+=K(a.cells[b],d,""));return K(c,"tr","")},K=function(a,b,c){var d=c?' style="'+c+'"':"";return"<"+b+d+">"+a+"</"+b+">"},L={url:"",sql:"",server:"",chunkSize:0,columns:{},labels:[],rowHandler:J,cellHandler:v,dataHandler:q,errorHandler:a.noop,userCallback:a.noop,loading:"",headers:0,headersOff:!1,rowGroups:!0,formatting:!1,resetStatus:!1,debug:!1};return b.working=!1,b.promise=a.Deferred().resolve(),b.options=L,b.version="0.3.0",a.fn.sheetrock=b,b});
//# sourceMappingURL=jquery.sheetrock.min.map